spring:
  # Use H2 for unit tests, Testcontainers will override for integration tests
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password: 
    
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: create-drop
    show-sql: false
    defer-datasource-initialization: true
    
  # Disable Liquibase for tests
  liquibase:
    enabled: false
    
  # Test Redis configuration (will be overridden by Testcontainers)
  data:
    redis:
      host: localhost
      port: 6379
      timeout: 1000ms
      
  cache:
    type: simple # Use simple cache for tests
    
  # Disable security for tests
  security:
    user:
      name: test
      password: test

# jPOS test configuration
jpos:
  server:
    enabled: false # Disable jPOS server in tests
    port: 18120 # Different port for tests
    host: localhost
    max-sessions: 10
    virtual-threads: false # Disable for tests
  
  security:
    enabled: false # Disable security for tests
    jwt-secret: test-secret-key-for-testing-only
    jwt-expiration: 300000 # 5 minutes for tests
  
  transaction:
    timeout: 5000 # Shorter timeout for tests
    max-parallel: 10
    retry-attempts: 1

# Management endpoints for testing
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
  security:
    enabled: false

# Logging configuration for tests
logging:
  level:
    com.company.jpos: DEBUG
    org.springframework.test: INFO
    org.springframework.boot.test: INFO
    org.testcontainers: INFO
    org.jpos: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.orm.jdbc.bind: TRACE
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# Resilience4j test configuration
resilience4j:
  circuitbreaker:
    instances:
      transaction-processor:
        register-health-indicator: false
        sliding-window-size: 10
        minimum-number-of-calls: 5
        failure-rate-threshold: 50
        wait-duration-in-open-state: 5000ms
  
  ratelimiter:
    instances:
      transaction-processor:
        limit-for-period: 100
        limit-refresh-period: 1s
  
  retry:
    instances:
      transaction-processor:
        max-attempts: 2
        wait-duration: 100ms